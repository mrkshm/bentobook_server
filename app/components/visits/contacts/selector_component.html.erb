<%= turbo_frame_tag frame_id do %>
  <% content_for :title, t("contacts.selector.title") %>
  
  <div class="space-y-6 hotwire-native:mt-4" data-controller="contact-search">
    <div class="relative">
      <%= form_with url: search_visit_contacts_path(visit_id: @visit.id, locale: nil),
          method: :get,
          data: { turbo_frame: "search-results" } do |f| %>
        <%= f.search_field :query,
            class: "w-full px-4 py-2 pl-10 border-surface-300 rounded-lg",
            placeholder: t("contacts.search.placeholder"),
            data: { 
              contact_search_target: "input",
              action: "input->contact-search#performSearch"
            } %>
      <% end %>
    </div>

    <div class="space-y-4">
      <h4 class="font-medium text-surface-900"><%= t("contacts.frequent") %></h4>
      <div data-contact-search-target="frequent">
        <%= render(ContactListComponent.new(
          contacts: @frequent_contacts,
          visit: @visit
        )) %>
      </div>
    </div>

    <%= turbo_frame_tag "search-results", class: "block mt-6" do %>
      <%# Initially empty - will be populated by search %>
    <% end %>

    <div class="mt-6 flex items-center justify-end gap-4">
      <%= link_to t("common.cancel"),
          visit_contacts_path(visit_id: @visit.id, locale: nil),
          class: "px-4 py-2 text-surface-700 bg-surface-100 hover:bg-surface-200 rounded-lg transition-colors",
          data: { turbo_frame: helpers.hotwire_native_app? ? "_top" : frame_id } %>
    </div>
  </div>
<% end %>