<h1 class="text-4xl my-4 font-bold text-surface-700"><%= t('restaurants.index.title') %></h1>

<% flash.each do |type, message| %>
  <div class="px-4 py-3 rounded-lg mb-4 <%= type == 'notice' ? 'bg-primary-100 text-primary-700' : 'bg-error-100 text-error-700' %>">
    <%= message %>
  </div>
<% end %>

<% if params[:tag].present? %>
  <div class="px-4 py-3 rounded-lg mb-4 bg-primary-100 text-primary-700">
    Showing restaurants tagged with "<%= params[:tag] %>"
  </div>
<% end %>

<div class="mb-4">
  <%= link_to t('restaurants.create_restaurant_button'), new_restaurant_path, class: 'inline-flex items-center px-4 py-2 bg-primary-600 text-surface-50 font-medium rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors' %>
</div>

<div class="mb-4 flex flex-col md:flex-row justify-between items-end gap-4">
  <%= render SortFormComponent.new(
    url: restaurants_path,
    fields: {
      'name' => t('restaurants.index.sort_options.name'),
      'rating' => t('restaurants.index.sort_options.rating'),
      'price_level' => t('restaurants.index.sort_options.price_level'),
      'distance' => t('restaurants.index.sort_options.distance')
    },
    current_order: params[:order_by] || 'name',
    current_direction: params[:order_direction] || 'asc',
    additional_fields: {
      tag: params[:tag],
      search: params[:search]
    }
  ) %>

  <%= form_tag restaurants_path, method: :get, class: "relative" do %>
    <%= hidden_field_tag :order_by, params[:order_by] %>
    <%= hidden_field_tag :order_direction, params[:order_direction] %>
    <div class="relative">
      <%= text_field_tag :search, params[:search], 
          class: "w-full px-4 py-2 pr-10 border border-surface-300 rounded-lg bg-surface-50 text-surface-900 focus:outline-none focus:ring-2 focus:ring-primary-500",
          placeholder: t('restaurants.index.search_placeholder') %>
      <button type="submit" class="absolute inset-y-0 right-0 flex items-center px-3 text-surface-400 hover:text-surface-600">
        <%= heroicon "magnifying-glass", options: { class: "w-5 h-5" } %>
      </button>
    </div>
  <% end %>
</div>

<div class="min-h-screen bg-surface-100" data-controller="app--frontend--controllers--restaurants">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <% if @restaurants.empty? %>
      <p class="text-surface-600 text-center py-8"><%= t('restaurants.index.no_restaurants_found') %></p>
    <% else %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-start" data-app--frontend--controllers--restaurants-target="list">
        <% @restaurants.each do |restaurant| %>
          <div class="w-full">
            <%= render(RestaurantCardComponent.new(restaurant: restaurant)) %>
          </div>
        <% end %>
      </div>

      <div class="flex flex-col items-center space-y-4 mt-8">
        <nav class="flex items-center space-x-2 text-surface-500" role="navigation" aria-label="Pagination">
          <%== pagy_nav(@pagy) %>
        </nav>
        <div class="text-sm text-surface-600 bg-surface-100 px-4 py-2 rounded-lg">
          <%== pagy_info(@pagy) %>
        </div>
      </div>
    <% end %>
  </div>
</div>
