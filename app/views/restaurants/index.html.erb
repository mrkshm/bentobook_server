<h1 class="text-4xl my-4 font-bold text-surface-700"><%= t('restaurants.index.title') %></h1>

<% flash.each do |type, message| %>
  <div class="px-4 py-3 rounded-lg mb-4 <%= type == 'notice' ? 'bg-primary-100 text-primary-700' : 'bg-error-100 text-error-700' %>">
    <%= message %>
  </div>
<% end %>

<% if params[:tag].present? %>
  <div class="px-4 py-3 rounded-lg mb-4 bg-primary-100 text-primary-700">
    Showing restaurants tagged with "<%= params[:tag] %>"
  </div>
<% end %>

<div class="mb-4">
  <%= link_to t('restaurants.create_restaurant_button'), new_restaurant_path, class: 'inline-flex items-center px-4 py-2 bg-primary-600 text-surface-50 font-medium rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors' %>
</div>

<div class="mb-4 flex flex-col md:flex-row justify-between items-end gap-4">
  <form action="<%= restaurants_path %>" method="get" class="w-full md:w-auto" 
        data-controller="sort-form"
        data-sort-form-target="form">
    
    <div class="flex flex-col md:flex-row gap-4">
      <div class="flex-1">
        <select name="order_by" 
                class="w-full px-4 py-2 border border-surface-300 rounded-lg bg-surface-50 text-surface-900 focus:outline-none focus:ring-2 focus:ring-primary-500"
                data-sort-form-target="sort"
                data-action="change->sort-form#sortChanged">
          <%= options_for_select([
            [t('restaurants.index.sort_options.name'), 'name'],
            [t('restaurants.index.sort_options.rating'), 'rating'],
            [t('restaurants.index.sort_options.price_level'), 'price_level'],
            [t('restaurants.index.sort_options.distance'), 'distance']
          ], params[:order_by] || 'name') %>
        </select>
      </div>

      <div class="flex-1">
        <select name="order_direction" 
                class="w-full px-4 py-2 border border-surface-300 rounded-lg bg-surface-50 text-surface-900 focus:outline-none focus:ring-2 focus:ring-primary-500"
                data-sort-form-target="orderAsc"
                data-action="change->sort-form#orderChanged">
          <%= options_for_select([
            [t('restaurants.index.order_options.asc'), 'asc'],
            [t('restaurants.index.order_options.desc'), 'desc']
          ], params[:order_direction] || 'asc') %>
        </select>
      </div>
    </div>

    <input type="hidden" name="latitude" data-sort-form-target="lat">
    <input type="hidden" name="longitude" data-sort-form-target="lng">
  </form>

  <%= form_tag restaurants_path, method: :get, class: 'w-full md:w-1/2', id: 'search-form' do %>
    <div class="flex flex-col md:flex-row items-end gap-2">
      <div class="w-full">
        <label for="search-input" class="block text-sm font-medium text-surface-700 mb-1">
          <%= t('search') %>:
        </label>
        <div class="flex gap-2">
          <input type="text" id="search-input" name="search" value="<%= params[:search] %>" 
                 class="block w-full px-3 py-2 bg-surface-50 border border-surface-300 rounded-lg shadow-sm focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500" 
                 placeholder=<%= t('restaurants.index.search_restaurants_placeholder') %>>
          <%= submit_tag t("search"), class: 'px-4 py-2 bg-primary-600 text-surface-50 font-medium rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors whitespace-nowrap' %>
          <%= button_tag t("reset"), type: 'button', 
              class: 'px-4 py-2 text-surface-700 bg-surface-50 border border-surface-300 rounded-lg hover:bg-surface-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-surface-500 transition-colors whitespace-nowrap', 
              onclick: "window.location='#{restaurants_path}'" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="min-h-screen bg-surface-100" data-controller="app--frontend--controllers--restaurants">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
    <% if @restaurants.empty? %>
      <p class="text-surface-600 text-center py-8"><%= t('restaurants.index.no_restaurants_found') %></p>
    <% else %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-start" data-app--frontend--controllers--restaurants-target="list">
        <% @restaurants.each do |restaurant| %>
          <div class="w-full">
            <%= render(RestaurantCardComponent.new(restaurant: restaurant)) %>
          </div>
        <% end %>
      </div>

      <div class="flex flex-col items-center space-y-4 mt-8">
        <nav class="flex items-center space-x-2 text-surface-500" role="navigation" aria-label="Pagination">
          <%== pagy_nav(@pagy) %>
        </nav>
        <div class="text-sm text-surface-600 bg-surface-100 px-4 py-2 rounded-lg">
          <%== pagy_info(@pagy) %>
        </div>
      </div>
    <% end %>
  </div>
</div>
