<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <title>BentobookServer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= javascript_tag nonce: true do %>
      window.googleMapsApiKey = "<%= Rails.application.credentials.google_maps_api_key %>";
    <% end %>
    <%= javascript_include_tag "turbo", type: "module" %>
    <style>
      /* Inline critical CSS */
      body { opacity: 0; transition: opacity 0.3s ease-in; }
    </style>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload", media: "print", onload: "this.media='all'; document.body.style.opacity = '1';" %>
    <%= vite_client_tag %>
    <%= vite_javascript_tag 'application' %>
    <script>
      // Apply theme from localStorage immediately
      const storedTheme = localStorage.getItem('theme');
      if (storedTheme) {
        document.documentElement.setAttribute('data-theme', storedTheme);
      }
    </script>
  </head>
  <body class="bg-base-100">
    <!-- loading indicator -->
    <div id="loading-indicator" class="fixed inset-0 flex items-center justify-center bg-base-100 z-50" style="display: none;">
      <div class="loading loading-spinner loading-lg"></div>
    </div>

    <div class="min-h-screen flex flex-col">
      <nav class="bg-base-200 shadow">
        <div class="navbar mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div class="flex-1">
            <div class="flex-shrink-0 flex items-center">
              <% if user_signed_in? %>
                <%= link_to "BentoBook", restaurants_path, class: "text-xl font-bold text-primary" %>
              <% else %>
                <%= link_to "BentoBook", root_path, class: "text-xl font-bold text-primary" %>
              <% end %>
            </div>
          </div>
          
          <!-- Hamburger menu for mobile -->
          <div class="flex-none lg:hidden">
            <button class="btn btn-square btn-ghost" id="mobile-menu-button" type="button">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
          </div>
          
          <!-- Desktop menu -->
          <div class="flex-none hidden lg:flex">
            <!-- User menu -->
            <div class="ml-6 flex items-center">
              <% if user_signed_in? %>
                <%= link_to t("nav.restaurants"), restaurants_path, class: "btn btn-ghost" %>
                <%= link_to t("nav.visits"), visits_path, class: "btn btn-ghost" %>
                <%= link_to t("nav.profile"), profile_path, class: "btn btn-ghost" %>
                <%= link_to t("sign_out"), destroy_user_session_path, method: :delete, class: "btn btn-ghost" %>
              <% else %>
                <%= link_to t("sign_in"), new_user_session_path, class: "btn btn-ghost" %>
                <%= link_to t("sign_up"), new_user_registration_path, class: "btn btn-ghost" %>
              <% end %>
            </div>
          </div>
        </div>
        
        <!-- Mobile menu (hidden by default) -->
        <div id="mobile-menu" style="display: none;">
          <ul class="menu menu-vertical px-1">
            <% if user_signed_in? %>
              <li><%= link_to 'Restaurants', restaurants_path %></li>
              <li><%= link_to 'Visits', visits_path %></li>
              <li><%= link_to 'My Profile', profile_path %></li>
              <li><%= link_to 'Sign Out', destroy_user_session_path, method: :delete %></li>
            <% else %>
              <li><%= link_to 'Sign In', new_user_session_path %></li>
              <li><%= link_to 'Sign Up', new_user_registration_path %></li>
            <% end %>
          </ul>
        </div>
      </nav>

        <main class="flex-grow">
          <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
            <% if notice %><div class="alert alert-info"><%= notice %></div><% end %>
            <% if alert %><div class="alert alert-error"><%= alert %></div><% end %>
            <%= yield %>
          </div>
        </main>

      <footer class="bg-base-200">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4">
          <p class="text-center text-base-content text-sm">&copy; <%= Time.current.year %> BentoBook. <%= t("all_rights_reserved") %></p>
        </div>
      </footer>
    </div>

    <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=#{Rails.application.credentials.google_maps_api_key}&libraries=places", async: true, defer: true %>
    <script>
      document.addEventListener("turbo:before-render", function() {
        document.body.style.opacity = '0';
        document.getElementById('loading-indicator').style.display = 'flex';
      });

      document.addEventListener("turbo:render", function() {
        document.body.style.opacity = '1';
        document.getElementById('loading-indicator').style.display = 'none';
      });
    </script>
  </body>
</html>